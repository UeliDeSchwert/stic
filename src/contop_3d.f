      FUNCTION COULX(N,FREQ,Z)
C
      DIMENSION A(6),B(6),C(6)
      SAVE A,B,C
      DATA A/0.9916,1.105,1.101,1.101,1.102,1.0986/
      DATA B/2.719E3,-2.375E4,-9.863E3,-5.765E3,-3.909E3,-2.704E3/
      DATA C/-2.268E10,4.077E8,1.035E8,4.593E7,2.371E7,1.229E7/
C
      IF(FREQ.LT.Z*Z*3.28805E15/(N*N)) THEN
        COULX=0.
      ELSE IF(N.GT.6) THEN
        FREQ1=FREQ*1.E-10
        COULX=0.2815/FREQ1/FREQ1/FREQ1/(N**5)*Z**4
      ELSE
        FREQ1=FREQ*1.E-10
        COULX=0.2815/FREQ1/FREQ1/FREQ1/(N**5)*Z**4
        COULX=COULX*(A(N)+(B(N)+C(N)*(Z*Z/FREQ1))*(Z*Z/FREQ1))
      END IF
C
      RETURN
      END

      FUNCTION COULFF(TLOG,FREQLG,NZ)
C
      DOUBLE PRECISION FREQLG
      DIMENSION Z4LOG(6),A(11,12)
      SAVE Z4LOG,A
      DATA Z4LOG/0.,1.20412,1.90849,2.40824,2.79588,3.11261/
      DATA A/
     1 5.53,5.49,5.46,5.43,5.40,5.25,5.00,4.69,4.48,4.16,3.85,
     2 4.91,4.87,4.84,4.80,4.77,4.63,4.40,4.13,3.87,3.52,3.27,
     3 4.29,4.25,4.22,4.18,4.15,4.02,3.80,3.57,3.27,2.98,2.70,
     4 3.64,3.61,3.59,3.56,3.54,3.41,3.22,2.97,2.70,2.45,2.20,
     5 3.00,2.98,2.97,2.95,2.94,2.81,2.65,2.44,2.21,2.01,1.81,
     6 2.41,2.41,2.41,2.41,2.41,2.32,2.19,2.02,1.84,1.67,1.50,
     7 1.87,1.89,1.91,1.93,1.95,1.90,1.80,1.68,1.52,1.41,1.30,
     8 1.33,1.39,1.44,1.49,1.55,1.56,1.51,1.42,1.33,1.25,1.17,
     9 0.90,0.95,1.00,1.08,1.17,1.30,1.32,1.30,1.20,1.15,1.11,
     A 0.55,0.58,0.62,0.70,0.85,1.01,1.15,1.18,1.15,1.11,1.08,
     B 0.33,0.36,0.39,0.46,0.59,0.76,0.97,1.09,1.13,1.10,1.08,
     C 0.19,0.21,0.24,0.28,0.38,0.53,0.76,0.96,1.08,1.09,1.09/
C
C     GAMLOG=LOG10(158000*Z*Z/T)*2
C
      GAMLOG=10.39638-TLOG/1.15129+Z4LOG(NZ)
      IGAM=MAX(MIN(INT(GAMLOG+7.),10),1)
C
C     HVKTLG=2*LOG10(HVKT)
C
      HVKTLG=(FREQLG-TLOG)/1.15129-20.63764
      IHVKT=MAX(MIN(INT(HVKTLG+9.),11),1)
      P=GAMLOG-(IGAM-7)
      Q=HVKTLG-(IHVKT-9)
      COULFF=(1.-P)*((1.-Q)*A(IGAM,IHVKT)+Q*A(IGAM,IHVKT+1))+
     +    P*((1.-Q)*A(IGAM+1,IHVKT)+Q*A(IGAM+1,IHVKT+1))
C
      RETURN
      END

      SUBROUTINE HOP(AHYD,XNE,XH1,XH2,FREQ,FREQLG,T,TLOG,TKEV,
     *               STIM,EHVKT)
C
C     REQUIRES FUNCTIONS COULX AND COULFF
C
      IMPLICIT NONE
      REAL AHYD,XH1,XH2,XNE,FREQ,T,TLOG,TKEV,STIM,EHVKT
      INTEGER N
      DOUBLE PRECISION FREQLG,C,H,CFREE,FREQ3,FREET
      REAL CONT(8),BOLT(8),EXLIM,BOLTEX,COULX,COULFF,XR
C
      FREQ3=(FREQ*1.D-10)**3
      CFREE=3.6919D-22/FREQ3
      DO N=1,8
        BOLT(N)=EXP(-13.595*(1.-1./(N*N))/TKEV)*2.*(N*N)*XH1
      END DO
      FREET=XNE*CFREE*XH2/SQRT(T)
C
C A bug found by OK in Aug. 2000 was this factor 4 in the line below
C      XR=XH1*4./13.595*TKEV
C this should be:
C      XR=XH1*(2/2/13.595*TKEV
      XR=XH1/13.595*TKEV
      BOLTEX=EXP(-13.427/TKEV)*XR
      EXLIM=EXP(-13.595/TKEV)*XR
      DO N=1,8
        CONT(N)=COULX(N,FREQ,1.0)
      END DO
      C=0.2815D0/FREQ3
      IF(FREQ.LT.4.05933E13) BOLTEX=EXLIM/EHVKT
      H=(CONT(7)*BOLT(7)+CONT(8)*BOLT(8)+(BOLTEX-EXLIM)*C+
     +   COULFF(TLOG,FREQLG,1)*FREET)*STIM
      DO N=1,6
        H=H+CONT(N)*BOLT(N)*(1.-EHVKT)
      END DO
      AHYD=H
C
      RETURN
      END

      SUBROUTINE HRAYOP(SIGH,XH1,FREQ)
C
      REAL SIGH,XH1,FREQ,WAVE,WW,SIG
C
      WAVE=2.997925E18/MIN(FREQ,2.463E15)
      WW=WAVE**2
      SIG=(5.799E-13+1.422E-6/WW+2.784/(WW*WW))/(WW*WW)
      SIGH=SIG*XH1*2.
C
      RETURN
      END

      SUBROUTINE H2PLOP(AH2P,XH1,XH2,FREQ,FREQLG,FREQ15,TKEV,STIM)
C
      IMPLICIT NONE
      DOUBLE PRECISION ES,FR,FREQLG
      REAL AH2P,FREQ,FREQ15,Xh1,XH2,TKEV,STIM
C
      AH2P=0.
      IF(FREQ.GT.3.28805E15) RETURN
      FR=-3.0233E3+(3.7797E2+(-1.82496E1+(3.9207E-1-3.1672E-3*FREQLG)*
     *FREQLG)*FREQLG)*FREQLG
      ES=-7.342E-3+(-2.409+(1.028+(-0.4230+(0.1224-0.01351*FREQ15)*
     *   FREQ15)*FREQ15)*FREQ15)*FREQ15
      AH2P=EXP(-ES/TKEV+FR)*2.*XH1*XH2*STIM
C
      RETURN
      END

      SUBROUTINE HMINOP(AHMIN,XH1,XHMIN,FREQ,T,TKEV,XNE,EHVKT)
C
      IMPLICIT NONE
      REAL AHMIN,XH1,XHMIN,FREQ,T,TKEV,XNE,EHVKT
      REAL FREQ1,B,C,H,HMINBF,HMINFF,HMIN
C
      FREQ1=FREQ*1.E-10
      B=(1.3727E-15+4.3748/FREQ)/FREQ1
      C=-2.5993E-7/FREQ1**2

      IF(FREQ.LE.1.8259E14) THEN
        HMINBF=0.
      ELSE IF(FREQ.GE.2.111E14) THEN
        HMINBF=6.801E-10+(5.358E-3+(1.481E3+(-5.519E7+4.808E11/FREQ1)/
     /         FREQ1)/FREQ1)/FREQ1
      ELSE
        HMINBF=3.695E-6+(-1.251E-1+1.052E3/FREQ1)/FREQ1
      END IF
      HMINFF=(B+C/T)*XH1*XNE*2.E-20
C
C  We use the number density / partition function for H-.
C  The partition function for H- is 1 and not 2 as was mistakenly
C  used before (fixed 2007-12-15, NP)! The EOS calculations are
C  good up to 7730K, we use Kurucz approximation for higher T.
C
      IF(T.LT.7730.) THEN
        HMIN=XHMIN
      ELSE
        HMIN=EXP(0.7552/TKEV)/(2.*2.4148E15*T*SQRT(T))*XH1*XNE
      END IF
      H=HMINBF*(1-EHVKT)*HMIN*1.E-10
      AHMIN=H+HMINFF
C
      RETURN
      END

      SUBROUTINE HE1OP(AHE1,XHE1,XHE2,XNE,FREQ,FREQLG,
     *                 T,TKEV,TLOG,EHVKT,STIM)
C
C     REQUIRES FUNCTION COULFF
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL AHE1,XHE1,XHE2,XNE,FREQ,T,TLOG,TKEV,EHVKT,STIM
      INTEGER N,NMIN
      REAL CHI(10),BOLT(10),HEFREQ(10),BOLTEX,XRLOG,HE1,EX,EXLIM,COULFF
      DOUBLE PRECISION FREQ3,FREET,CFREE,TRANS(10),G(10),C
      SAVE G,HEFREQ,CHI
C
      DATA G/1.,3.,1.,9.,3.,3.,1.,9.,20.,3./
      DATA HEFREQ/5.945209E15,1.152844E15,.9803331E15,.8761076E15,
     1             .814710E15,.4519048E15,.4030971E15,.8321191E15,
     2             .3660215E15,.3627891E15/
      DATA CHI/0.,19.819,20.615,20.964,21.217,22.718,22.920,23.006,
     1            23.073,23.086/
C
      DO N=1,10
        BOLT(N)=EXP(-CHI(N)/TKEV)*G(N)*XHE1
      END DO
      FREET=XNE*1.E-10*XHE2*1.E-10/SQRT(T)*1.E-10
      XRLOG=LOG(XHE1*(2./13.595)*TKEV)
      BOLTEX=EXP(-23.730/TKEV+XRLOG)
      EXLIM=EXP(-24.587/TKEV+XRLOG)
      FREQ3=(FREQ*1.D-10)**3
      CFREE=3.6919D8/FREQ3
      C=2.815D-1/FREQ3
      DO NMIN=1,10
        TRANS(NMIN)=0.
        IF(HEFREQ(NMIN).LE.FREQ) GO TO 4
      END DO
      GO TO 15
   4  GO TO(5,6,7,8,9,10,11,12,13,14),NMIN
   5  TRANS(1)=EXP(33.32-2.*FREQLG)
   6  TRANS(2)=EXP(-390.026+(21.035-0.318*FREQLG)*FREQLG)
   7  TRANS(3)=EXP(26.83-1.91*FREQLG)
   8  TRANS(4)=EXP(61.21-2.9*FREQLG)
   9  TRANS(5)=EXP(81.35-3.5*FREQLG)
  10  TRANS(6)=EXP(12.69-1.54*FREQLG)
  11  TRANS(7)=EXP(23.85-1.86*FREQLG)
  12  TRANS(8)=EXP(49.30-2.60*FREQLG)
  13  TRANS(9)=EXP(85.20-3.69*FREQLG)
  14  TRANS(10)=EXP(58.81-2.89*FREQLG)
  15  EX=BOLTEX
      IF(FREQ.LT.2.055E14) EX=EXLIM/EHVKT
      HE1=(EX-EXLIM)*C
      DO N=1,10
        HE1=HE1+TRANS(N)*BOLT(N)
      END DO
      AHE1=(HE1+COULFF(TLOG,FREQLG,1)*FREET*CFREE)*STIM
C
      RETURN
      END

      SUBROUTINE HE2OP(AHE2,XHE2,XHE3,XNE,FREQ,FREQLG,T,TKEV,EHVKT,
     *                 STIM)
C
C     REQUIRES FUNCTIONS COULX AND COULFF
C     FREQUENCIES ARE 4X HYDROGEN,CHI ARE FOR ION POT=54.403
C
      IMPLICIT NONE
      INTEGER N
      REAL AHE2,XHE2,XHE3,XNE,T,TKEV,TLOG,FREQ,EHVKT,STIM,
     *     COULX,COULFF
      DOUBLE PRECISION HE2,C,FREQ3,EX,XR,CFREE,BOLT(9),CONT(9),
     *                 EXLIM,FREET,BOLTEX,FREQLG
C
      DO N=1,9
        BOLT(N)=EXP(-(54.403D0-54.403D0/(N*N))/TKEV)*2.*(N*N)*
     *          XHE2
      END DO
      FREET=XNE*XHE3/SQRT(T)
      XR=XHE2/13.595D0*TKEV
      BOLTEX=EXP(-53.859D0/TKEV)*XR
      EXLIM=EXP(-54.403D0/TKEV)*XR
      DO N=1,9
        CONT(N)=COULX(N,FREQ,2.0)
      END DO
      FREQ3=(FREQ*1.D-05)**3
      CFREE=3.6919D-07/FREQ3*4.D0
      C=2.815D14*2.D0*2.D0/FREQ3
      EX=BOLTEX
      IF(FREQ.LT.1.31522E14) EX=EXLIM/EHVKT
      HE2=(EX-EXLIM)*C
      DO N=1,9
        HE2=HE2+CONT(N)*BOLT(N)
      END DO
      HE2=(HE2+COULFF(TLOG,FREQLG,2)*CFREE*FREET)*STIM
      IF(HE2.GE.1.E-20) THEN
        AHE2=HE2
      ELSE
        AHE2=0.0
      END IF
C
      RETURN
      END

      SUBROUTINE HEMIOP(AHEMIN,XHE1,FREQ,T,XNE)
C
      IMPLICIT NONE
      REAL AHEMIN,XHE1,FREQ,T,XNE
      REAL A,B,C
C
      A= 3.397E-26+(-5.216E-11+7.039E05/FREQ)/FREQ
      B=-4.116E-22+( 1.067E-06+8.135E09/FREQ)/FREQ
      C= 5.081E-17+(-8.724E-03-5.659E12/FREQ)/FREQ
      AHEMIN=(A*T+B+C/T)*XNE*XHE1*1.E-20
C
      RETURN
      END

      SUBROUTINE HERAOP(SIGHE,XHE1,FREQ)
C
      IMPLICIT NONE
      REAL SIGHE,FREQ,XHE1
      REAL WAVE,WW,SIG
C
      WAVE=2.997925E+03/MIN(FREQ*1.E-15,5.15)
      WW=WAVE*WAVE
      SIG=5.484E-14/WW/WW*(1.+(2.44E5+5.94E10/(WW-2.90E5))/WW)**2
      SIGHE=SIG*XHE1
C
      RETURN
      END

      SUBROUTINE COOLOP(ACOOL,XC1,XMg1,XAl1,XSi1,XFe1,STIM,
     *                  FREQ,FREQLG,T,TLOG,TKEV,HKT)
C
C     Si I, Mg I, Al I, C I, Fe I
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL ACOOL,XC1,XMg1,XAl1,XSi1,XFe1,STIM,FREQ,T,TLOG,TKEV,HKT
      REAL C1OP,Mg1OP,Al1OP,Si1OP,Fe1OP
C
C      write(*,*) XC1,XMg1,XAl1,XSi1,XFe1
      ACOOL=( C1OP(FREQ,TKEV         )*XC1 +
     +       Mg1OP(FREQ,FREQLG,T,TLOG)*XMg1+
     +       Al1OP(FREQ              )*XAl1+
     +       Si1OP(FREQ,FREQLG,T,TLOG)*XSi1+
     +       Fe1OP(FREQ,HKT          )*XFe1)*STIM
C
      RETURN
      END

      REAL FUNCTION C1OP(FREQ,TKEV)
C
C     CROSS-SECTION TIMES THE PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL TKEV,FREQ
      REAL C1240,C1444,X1444,X1240,X1100,SEATON
C
      C1240=5.*EXP(-1.264/TKEV)
      C1444=EXP(-2.683/TKEV)
      X1444=0.
      X1240=0.
      X1100=0.
      IF(FREQ.GE.2.7254E15)
     *   X1100=SEATON(2.7254E15,1.219E-17,2.0E0,3.317E0,FREQ)
      IF(FREQ.GE.2.4196E15)
     *   X1240=SEATON(2.4196E15,1.030E-17,1.5E0,2.789E0,FREQ)
      IF(FREQ.GE.2.0761E15)
     *   X1444=SEATON(2.0761E15,9.590E-18,1.5E0,3.501E0,FREQ)
      C1OP=X1100*9.+X1240*C1240+X1444*C1444
C
      RETURN
      END

      REAL FUNCTION Mg1OP(FREQ,FREQLG,T,TLOG)
C
C     CROSS-SECTION TIMES THE PARTITION FUNCTION
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL FREQ,T,TLOG
      REAL FLOG(9),FREQMG(7),PEACH(7,15),TLG(7),DT,D,D1,XWL1,XWL2
      INTEGER N,NT
      SAVE PEACH,FLOG,FREQMG,TLG
      DATA PEACH/
C        4000     5000     6000     7000     8000     9000    10000
     1 -42.474, -42.350, -42.109, -41.795, -41.467, -41.159, -40.883,
     2 -41.808, -41.735, -41.582, -41.363, -41.115, -40.866, -40.631,
     3 -41.273, -41.223, -41.114, -40.951, -40.755, -40.549, -40.347,
     4 -45.583, -44.008, -42.957, -42.205, -41.639, -41.198, -40.841,
     5 -44.324, -42.747, -41.694, -40.939, -40.370, -39.925, -39.566,
     6 -50.969, -48.388, -46.630, -45.344, -44.355, -43.568, -42.924,
     7 -50.633, -48.026, -46.220, -44.859, -43.803, -42.957, -42.264,
     8 -53.028, -49.643, -47.367, -45.729, -44.491, -43.520, -42.736,
     9 -51.785, -48.352, -46.050, -44.393, -43.140, -42.157, -41.363,
     T -52.285, -48.797, -46.453, -44.765, -43.486, -42.480, -41.668,
     1 -52.028, -48.540, -46.196, -44.507, -43.227, -42.222, -41.408,
     2 -52.384, -48.876, -46.513, -44.806, -43.509, -42.488, -41.660,
     3 -52.363, -48.856, -46.493, -44.786, -43.489, -42.467, -41.639,
     4 -54.704, -50.772, -48.107, -46.176, -44.707, -43.549, -42.611,
     5 -54.359, -50.349, -47.643, -45.685, -44.198, -43.027, -42.418/
      DATA FREQMG/1.9341452E15,1.8488510E15,1.1925797E15,7.9804046E14,
     1            4.5772110E14,4.1440977E14,4.1113514E14/
      DATA FLOG/35.32123,35.19844,35.15334,34.71490,34.31318,33.75728,
     1          33.65788,33.64994,33.43947/
      DATA TLG/8.29405,8.51719,8.69951,8.85367,8.98720,9.10498,9.21034/
C
      NT=MAX(MIN(6,INT(T/1000.)-3),1)
      DT=(TLOG-TLG(NT))/(TLG(NT+1)-TLG(NT))
      DO N=1,7
        IF(FREQ.GT.FREQMG(N)) GO TO 2
      END DO
      N=8
   2  D=(FREQLG-FLOG(N))/(FLOG(N+1)-FLOG(N))
      IF(N.GT.2) N=2*N-2
      D1=1.-D
      XWL1=PEACH(NT  ,N+1)*D+PEACH(NT  ,N)*D1
      XWL2=PEACH(NT+1,N+1)*D+PEACH(NT+1,N)*D1
      MG1OP=EXP(XWL1*(1.-DT)+XWL2*DT)
C
      RETURN
      END

      REAL FUNCTION AL1OP(FREQ)
C
      IMPLICIT NONE
      REAL FREQ
C
      AL1OP=0.
      IF(FREQ.GE.1.443E15) AL1OP=2.1E-17*(1.443E15/FREQ)**3*6.
C
      RETURN
      END

      REAL FUNCTION Si1OP(FREQ,FREQLG,T,TLOG)
C
C     CROSS-SECTION TIMES THE PARTITION FUNCTION
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL FREQ,T,TLOG
      INTEGER N,NT
      REAL DT,DD,D,XWL1,XWL2
      REAL FLOG(11),FREQSI(9),TLG(9),PEACH(9,19)
      SAVE FLOG,FREQSI,TLG,PEACH
      DATA PEACH/
C      4000    5000   6000   7000   8000   9000  10000  11000  12000
     1 38.136,38.138,38.140,38.141,38.143,38.144,38.144,38.145,38.145,
     2 37.834,37.839,37.843,37.847,37.850,37.853,37.855,37.857,37.858,
     3 37.898,37.898,37.897,37.897,37.897,37.896,37.895,37.895,37.894,
     4 40.737,40.319,40.047,39.855,39.714,39.604,39.517,39.445,39.385,
     5 40.581,40.164,39.893,39.702,39.561,39.452,39.366,39.295,39.235,
     6 45.521,44.456,43.753,43.254,42.878,42.580,42.332,42.119,41.930,
     7 45.520,44.455,43.752,43.251,42.871,42.569,42.315,42.094,41.896,
     8 55.068,51.783,49.553,47.942,46.723,45.768,44.997,44.360,43.823,
     9 53.868,50.369,48.031,46.355,45.092,44.104,43.308,42.652,42.100,
     T 54.133,50.597,48.233,46.539,45.261,44.262,43.456,42.790,42.230,
     1 54.051,50.514,48.150,46.454,45.176,44.175,43.368,42.702,42.141,
     2 54.442,50.854,48.455,46.733,45.433,44.415,43.592,42.912,42.340,
     3 54.320,50.722,48.313,46.583,45.277,44.251,43.423,42.738,42.160,
     4 55.691,51.965,49.444,47.615,46.221,45.119,44.223,43.478,42.848,
     5 55.661,51.933,49.412,47.582,46.188,45.085,44.189,43.445,42.813,
     6 55.973,52.193,49.630,47.769,46.349,45.226,44.314,43.555,42.913,
     7 55.922,52.141,49.577,47.715,46.295,45.172,44.259,43.500,42.858,
     8 56.828,52.821,50.110,48.146,46.654,45.477,44.522,43.730,43.061,
     9 56.657,52.653,49.944,47.983,46.491,45.315,44.360,43.569,42.901/
C     3P,1D,1S,1D,3D,3F,1D,3P
      DATA FREQSI/2.1413750E15,1.9723165E15,1.7879689E15,1.5152920E15,
     1 .55723927E15,5.3295914E14,4.7886458E14,4.7216422E14,4.6185133E14/
      DATA FLOG/35.45438,35.30022,35.21799,35.11986,34.95438,33.95402,
     1          33.90947,33.80244,33.78835,33.76626,33.70518/
      DATA TLG/8.29405,8.51719,8.69951,8.85367,8.98720,9.10498,
     1         9.21034,9.30565,9.39266/
C
      NT=MAX(MIN(8,INT(T/1000.)-3),1)
      DT=(TLOG-TLG(NT))/(TLG(NT+1)-TLG(NT))
      DO N=1,9
        IF(FREQ.GT.FREQSI(N)) GO TO 2
      END DO
      N=10
   2  D=(FREQLG-FLOG(N))/(FLOG(N+1)-FLOG(N))
      IF(N.GT.2) N=2*N-2
      DD=1.-D
      XWL1=PEACH(NT  ,N+1)*D+PEACH(NT  ,N)*DD
      XWL2=PEACH(NT+1,N+1)*D+PEACH(NT+1,N)*DD
      Si1OP=EXP(-(XWL1*(1.-DT)+XWL2*DT))*9.
C
      RETURN
      END

      REAL FUNCTION Fe1OP(FREQ,HKT)
C
C     CROSS-SECTION TIMES PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL FREQ,HKT
      INTEGER I
      REAL BOLT(48),G(48),E(48),WNO(48),XSECT(48),WAVENO
      SAVE G,E,WNO
      DATA G/25.,35.,21.,15.,9.,35.,33.,21.,27.,49.,9.,21.,27.,9.,9.,
     1 25.,33.,15.,35.,3.,5.,11.,15.,13.,15.,9.,21.,15.,21.,25.,35.,
     2 9.,5.,45.,27.,21.,15.,21.,15.,25.,21.,35.,5.,15.,45.,35.,55.,25./
      DATA E/    500., 7500.,12500.,17500.,19000.,19500.,19500.,21000.,
     1  22000.,23000.,23000.,24000.,24000.,24500.,24500.,26000.,26500.,
     2  26500.,27000.,27500.,28500.,29000.,29500.,29500.,29500.,30000.,
     3  31500.,31500.,33500.,33500.,34000.,34500.,34500.,35000.,35500.,
     4  37000.,37000.,37000.,38500.,40000.,40000.,41000.,41000.,43000.,
     5  43000.,43000.,43000.,44000./
      DATA WNO/63500.,58500.,53500.,59500.,45000.,44500.,44500.,43000.,
     1  58000.,41000.,54000.,40000.,40000.,57500.,55500.,38000.,57500.,
     2  57500.,37000.,54500.,53500.,55000.,34500.,34500.,34500.,34000.,
     3  32500.,32500.,32500.,32500.,32000.,29500.,29500.,31000.,30500.,
     4  29000.,27000.,54000.,27500.,24000.,47000.,23000.,44000.,42000.,
     5  42000.,21000.,42000.,42000./
C
      WAVENO=FREQ/2.99792458E10
      FE1OP=0.
      IF(WAVENO.LT.21000.) RETURN
      DO I=1,48
        BOLT(I)=G(I)*EXP(-E(I)*2.99792458E10*HKT)
      END DO
      DO I=1,48
        XSECT(I)=0.
        IF(WNO(I).LT.WAVENO) 
     *    XSECT(I)=3.E-18/(1.+((WNO(I)+3000.-WAVENO)/WNO(I)/.1)**4)
      END DO
      DO I=1,48
        FE1OP=FE1OP+XSECT(I)*BOLT(I)
      END DO
C
      RETURN
      END

      SUBROUTINE LUKEOP(ALUKE,XN1,XO1,XMg2,XSi2,XCa2,STIM,
     *                  FREQ,FREQLG,T,TLOG,TKEV)
C
C     N I, O I, Si II, Mg II, Ca II
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL ALUKE,XN1,XO1,XMg2,XSi2,XCa2,STIM,FREQ,T,TLOG,TKEV
      REAL N1OP,O1OP,Mg2OP,Si2OP,Ca2OP
C
      ALUKE=( N1OP(FREQ,TKEV         )*XN1 +
     +        O1OP(FREQ              )*XO1 +
     +       Mg2OP(FREQ,TKEV         )*XMg2+
     +       Si2OP(FREQ,FREQLG,T,TLOG)*XSi2+
     +       Ca2OP(FREQ,TKEV         )*XCa2)*STIM
C
      RETURN
      END

      REAL FUNCTION N1OP(FREQ,TKEV)
C
C     CROSS-SECTION TIMES PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL FREQ,TKEV
      REAL C1130,C1020,X1130,X1020,X853,SEATON
C
      C1130=6.*EXP(-3.575/TKEV)
      C1020=10.*EXP(-2.384/TKEV)
      X1130=0.
      X1020=0.
      X853=0.
      IF(FREQ.GE.3.517915E15)
     *   X853 =SEATON(3.517915E15,1.142E-17,2.0E0,4.29E0,FREQ)
      IF(FREQ.GE.2.941534E15)
     *   X1020=SEATON(2.941534E15,4.410E-18,1.5E0,3.85E0,FREQ)
      IF(FREQ.GE.2.653317E15)
     *   X1130=SEATON(2.653317E15,4.200E-18,1.5E0,4.34E0,FREQ)
      N1OP=X853*4.+X1020*C1020+X1130*C1130
C
      RETURN
      END

      REAL FUNCTION O1OP(FREQ)
C
C     CROSS-SECTION TIMES PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL FREQ
      REAL SEATON
C
      IF(FREQ.GE.3.28805E15) THEN
        O1OP=9.*SEATON(3.28805E15,2.94E-18,1.E0,2.66E0,FREQ)
      ELSE
        O1OP=0.
      END IF
C
      RETURN
      END

      REAL FUNCTION Mg2OP(FREQ,TKEV)
C
C     CROSS-SECTION TIMES PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL FREQ,TKEV
      REAL C1169,X1169,X824,SEATON
C
      C1169=6.*EXP(-4.43/TKEV)
      X1169=0.
      X824=0.
      IF(FREQ.GE.3.635492E15)
     *   X824 =SEATON(3.635492E15,1.40E-19,4.E0,6.7E0,FREQ)
      IF(FREQ.GE.2.564306E15)
     *   X1169=5.11E-19*(2.564306E15/FREQ)**3
      Mg2OP=X824*2.+X1169*C1169
C
      RETURN
      END

      REAL FUNCTION Si2OP(FREQ,FREQLG,T,TLOG)
C
C     CROSS-SECTION TIMES THE PARTITION FUNCTION
C
      IMPLICIT NONE
      DOUBLE PRECISION FREQLG
      REAL FREQ,T,TLOG
      INTEGER NT,N
      REAL DT,D,D1,XWL1,XWL2
      REAL FLOG(9),FREQSI(7),PEACH(6,14),TLG(6)
      SAVE FLOG,FREQSI,PEACH,TLG
      DATA PEACH/
C        10000     12000     14000     16000     18000     20000
     1 -43.8941, -43.8941, -43.8941, -43.8941, -43.8941, -43.8941,
     2 -42.2444, -42.2444, -42.2444, -42.2444, -42.2444, -42.2444,
     3 -40.6054, -40.6054, -40.6054, -40.6054, -40.6054, -40.6054,
     4 -54.2389, -52.2906, -50.8799, -49.8033, -48.9485, -48.2490,
     5 -50.4108, -48.4892, -47.1090, -46.0672, -45.2510, -44.5933,
     6 -52.0936, -50.0741, -48.5999, -47.4676, -46.5649, -48.8246,
     7 -51.9548, -49.9371, -48.4647, -47.3340, -46.4333, -45.6947,
     8 -54.2407, -51.7319, -49.9178, -48.5395, -47.4529, -46.5709,
     9 -52.7355, -50.2218, -48.4059, -47.0267, -45.9402, -45.0592,
     T -53.5387, -50.9189, -49.0200, -47.5750, -46.4341, -45.5082,
     1 -53.2417, -50.6234, -48.7252, -47.2810, -46.1410, -45.2153,
     2 -53.5097, -50.8535, -48.9263, -47.4586, -46.2994, -45.3581,
     3 -54.0561, -51.2365, -49.1980, -47.6497, -46.4302, -45.4414,
     4 -53.8469, -51.0256, -48.9860, -47.4368, -46.2162, -45.2266/
      DATA FREQSI/4.9965417E15,3.9466738E15,1.5736321E15,1.5171539E15,
     1            9.2378947E14,8.3825004E14,7.6869872E14/
C     2P,2D,2P,2D,2P
      DATA FLOG/36.32984,36.14752,35.91165,34.99216,34.95561,34.45941,
     1          34.36234,34.27572,34.20161/
      DATA TLG/9.21034,9.39266,9.54681,9.68034,9.79813,9.90349/
C
      NT=MAX(MIN(5,INT(T/2000.)-4),1)
      DT=(TLOG-TLG(NT))/(TLG(NT+1)-TLG(NT))
      DO N=1,7
        IF(FREQ.GT.FREQSI(N)) GO TO 2
      END DO
      N=8
   2  D=(FREQLG-FLOG(N))/(FLOG(N+1)-FLOG(N))
      IF(N.GT.2) N=2*N-2
      IF(N.EQ.14) N=13
      D1=1.-D
      XWL1=PEACH(NT  ,N+1)*D+PEACH(NT  ,N)*D1
      XWL2=PEACH(NT+1,N+1)*D+PEACH(NT+1,N)*D1
      Si2OP=EXP(XWL1*(1.-DT)+XWL2*DT)*6.
C
      RETURN
      END

      REAL FUNCTION Ca2OP(FREQ,TKEV)
C
C     CROSS-SECTION TIMES THE PARTITION FUNCTION
C
      IMPLICIT NONE
      REAL FREQ,TKEV
      REAL C1218,C1420,X1420,X1218,X1044,SEATON
C
      C1218=10.*EXP(-1.697/TKEV)
      C1420=6.*EXP(-3.142/TKEV)
      X1420=0.
      X1218=0.
      X1044=0.
      IF(FREQ.GE.2.870454D15)
     *   X1044=1.08E-19*(2.870454E15/FREQ)**3
      IF(FREQ.GE.2.460127E15)
     *   X1218=1.64E-17*SQRT(2.460127E15/FREQ)
      IF(FREQ.GE.2.110779E15)
     *   X1420=SEATON(2.110779E15,4.13E-18,3.E0,0.69E0,FREQ)
      Ca2OP=X1044+X1218*C1218+X1420*C1420
C
      RETURN
      END

      REAL FUNCTION SEATON(FREQ0,XSECT,POWER,A,FREQ)
C
      IMPLICIT NONE
      REAL FREQ,FREQ0,XSECT,POWER,A
C
      SEATON=XSECT*(A+(1.-A)*(FREQ0/FREQ))*
     *       SQRT((FREQ0/FREQ)**(INT(2.*POWER+0.01)))
C
      RETURN
      END

      SUBROUTINE HOTOP(AHOT)
C
      REAL AHOT
C
C   DUMMY
C
      AHOT=0.
C
      RETURN
      END

      SUBROUTINE ELECOP(SIGEL,XNE)
C
      IMPLICIT NONE
      REAL SIGEL,XNE
C
      SIGEL=0.6653E-24*XNE
C
      RETURN
      END

      SUBROUTINE H2RAOP(SIGH2,XH1,FREQ,T,TKEV,TLOG)
C
      IMPLICIT NONE
      REAL SIGH2,FREQ,XH1,T,TKEV,TLOG
      DOUBLE PRECISION ARG,H1,SIG,WAVE,WW
C
      WAVE=2.997925D18/MIN(FREQ,2.922E15)
      WW=WAVE*WAVE
      SIG=(8.14D-13+1.28D-6/WW+1.61D0/(WW*WW))/(WW*WW)
      ARG=4.477/TKEV-4.6628E1+(1.8031E-3+(-5.023E-7+
     +    (8.1424E-11-5.0501E-15*T)*T)*T)*T-1.5*TLOG
      H1=XH1*2.D0
      IF(ARG.GT.-80.D0) THEN
        SIGH2=EXP(ARG)*H1*H1*SIG
      ELSE
        SIGH2=0.D0
      END IF
C
      RETURN
      END
